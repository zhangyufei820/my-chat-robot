<!-- ---------- index.html  科技 / 时尚风 ---------- -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Gemini AI 聊天工作站</title>
<style>
@import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap");
:root{
  --bg:#0d0f1a;--panel:#1e2136;--accent:#6a7dff;--accent2:#9a8cff;
  --text:#f4f6ff;--sub:#a7acd9;--border:#2e3150;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Poppins,'Noto Sans SC',sans-serif;background:var(--bg);color:var(--text);height:100vh;display:flex;flex-direction:column}
#container{max-width:1200px;margin:auto;display:flex;flex-direction:column;height:100%;padding:20px;gap:20px}
#personas{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:16px}
.persona{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:18px;text-align:center;cursor:pointer;transition:.3s;
box-shadow:0 4px 10px rgba(0,0,0,.25);}
.persona.active,.persona:hover{transform:translateY(-4px);border-color:var(--accent);box-shadow:0 8px 25px rgba(106,125,255,.4)}
.persona h3{font-size:18px;font-weight:600;line-height:1.3}
#chat{flex:1;display:flex;flex-direction:column;border:1px solid var(--border);border-radius:12px;overflow:hidden}
#log{flex:1;padding:24px;display:flex;flex-direction:column;gap:18px;overflow-y:auto;background:var(--panel)}
.msg{max-width:85%;display:flex;animation:fade .4s}
@keyframes fade{from{opacity:0;transform:translateY(8px)}to{opacity:1}}
.user .bubble{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;border-bottom-right-radius:4px}
.ai   .bubble{background:#272a45;color:var(--sub);border-bottom-left-radius:4px}
.bubble{padding:10px 16px;border-radius:20px;line-height:1.5;white-space:pre-wrap;word-break:break-word;box-shadow:0 3px 8px rgba(0,0,0,.25)}
#inputBar{padding:16px;background:rgba(13,15,26,.85);backdrop-filter:blur(8px);display:flex;gap:12px;border-top:1px solid var(--border)}
#msgInput{flex:1;padding:12px 18px;border-radius:24px;border:1px solid var(--border);background:var(--bg);color:var(--text);font-size:15px}
#msgInput:focus{outline:none;border-color:var(--accent)}
#send{width:48px;height:48px;border-radius:50%;border:none;cursor:pointer;background:var(--accent);display:flex;align-items:center;justify-content:center;
box-shadow:0 0 12px rgba(106,125,255,.6);transition:.3s}
#send:hover{transform:scale(1.08)}
#send svg{fill:#fff;width:22px;height:22px}
</style>
</head>
<body>
<div id="container">
  <div id="personas"></div>
  <div id="chat">
    <div id="log">
      <div class="msg ai"><div class="bubble">👋 请选择上方任一 AI 角色，然后开始对话！</div></div>
    </div>
    <div id="inputBar">
      <input id="msgInput" placeholder="请输入消息…" />
      <button id="send" title="发送">
        <svg viewBox="0 0 24 24"><path d="M2 21 23 12 2 3v7l15 2-15 2z"/></svg>
      </button>
    </div>
  </div>
  <input type="hidden" id="curPersona">
</div>

<script>
const personasDiv=document.getElementById('personas');
const log=document.getElementById('log');
const msgInput=document.getElementById('msgInput');
const sendBtn=document.getElementById('send');
const curPersona=document.getElementById('curPersona');

window.addEventListener('DOMContentLoaded',loadPersonas);
sendBtn.addEventListener('click',sendMsg);
msgInput.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMsg();}});

async function loadPersonas(){
  try{
    const res=await fetch('/get-personas'); if(!res.ok)throw new Error();
    const list=await res.json(); personasDiv.innerHTML='';
    for(const k in list){ const card=document.createElement('div');
      card.className='persona'; card.dataset.key=k;
      card.innerHTML=`<h3>${list[k]}</h3>`;
      card.onclick=()=>selectPersona(card,k);
      personasDiv.appendChild(card);} 
  }catch{personasDiv.innerHTML='<p style="color:red;">加载失败</p>';}
}
function selectPersona(el,key){
  document.querySelectorAll('.persona').forEach(c=>c.classList.remove('active'));
  el.classList.add('active'); curPersona.value=key;
  msgInput.placeholder=`以「${el.textContent}」的身份对话…`;
}
function addMsg(text,type){
  const div=document.createElement('div'); div.className=`msg ${type}`;
  div.innerHTML=`<div class="bubble">${text}</div>`; log.appendChild(div); log.scrollTop=log.scrollHeight;
  return div;
}
async function sendMsg(){
  const txt=msgInput.value.trim(); if(!txt)return;
  if(!curPersona.value){alert('请先选择角色');return;}
  addMsg(txt,'user'); msgInput.value='';
  const loading=addMsg('...', 'ai');
  try{
    const res=await fetch('/chat',{method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({message:txt,persona:curPersona.value})});
    const data=await res.json(); loading.querySelector('.bubble').textContent=data.reply||data.error;
  }catch{loading.querySelector('.bubble').textContent='❌ 网络错误';}
}
</script>
</body>
</html>
<!-- ---------- index.html 结束 ---------- -->

